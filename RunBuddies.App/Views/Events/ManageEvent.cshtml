@model Event

<div class="container mt-4">
    <h2>Manage Event: @Model.EventName</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">Event Details</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="participants-tab" data-bs-toggle="tab" data-bs-target="#participants" type="button" role="tab" aria-controls="participants" aria-selected="false">Participants</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="leaderboard-tab" data-bs-toggle="tab" data-bs-target="#leaderboard" type="button" role="tab" aria-controls="leaderboard" aria-selected="false">Leaderboard</button>
        </li>
    </ul>

    <div class="tab-content mt-3" id="myTabContent">
        <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
            <form asp-action="UpdateEvent" method="post">
                <input type="hidden" asp-for="EventID" />

                <div class="mb-3">
                    <label asp-for="EventName" class="form-label">Event Name</label>
                    <input asp-for="EventName" class="form-control" />
                    <span asp-validation-for="EventName" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="EventType" class="form-label">Event Type</label>
                    <input asp-for="EventType" class="form-control" />
                    <span asp-validation-for="EventType" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="DateTime" class="form-label">Date and Time</label>
                    <input asp-for="DateTime" class="form-control" type="datetime-local" />
                    <span asp-validation-for="DateTime" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Location" class="form-label">Location</label>
                    <input asp-for="Location" class="form-control" />
                    <span asp-validation-for="Location" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Description" class="form-label">Description</label>
                    <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                    <span asp-validation-for="Description" class="text-danger"></span>
                </div>

                <button type="submit" class="btn btn-primary">Update Event</button>
            </form>
        </div>


        <div class="tab-pane fade" id="participants" role="tabpanel" aria-labelledby="participants-tab">
            <h3>Participants</h3>
            <ul class="list-group">
                @foreach (var participant in Model.EventParticipants)
                {
                    <li class="list-group-item">@participant.User.UserName</li>
                }
            </ul>
        </div>

        <div class="tab-pane fade" id="leaderboard" role="tabpanel" aria-labelledby="leaderboard-tab">
            <h3>Leaderboard</h3>
            @if (Model.Leaderboard != null && Model.Leaderboard.Entries.Any())
            {
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>User</th>
                            <th>Time</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var entry in Model.Leaderboard.Entries.OrderBy(e => e.Rank))
                        {
                            <tr>
                                <td>@entry.Rank</td>
                                <td>@entry.User.UserName</td>
                                <td>@entry.Time.ToString(@"hh\:mm\:ss")</td>
                                <td>
                                    <button class="btn btn-sm btn-primary edit-leaderboard-entry" data-entry-id="@entry.LeaderboardEntryID">Edit</button>
                                    <button class="btn btn-sm btn-danger delete-leaderboard-entry" data-entry-id="@entry.LeaderboardEntryID">Delete</button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>No leaderboard entries yet.</p>
            }

            <h4 class="mt-4">Add Leaderboard Entry</h4>
            <form asp-action="AddLeaderboardEntry" method="post">
                <input type="hidden" name="eventId" value="@Model.EventID" />
                <div class="mb-3">
                    <label for="userId" class="form-label">User</label>
                    <select name="userId" class="form-select">
                        @foreach (var participant in Model.EventParticipants)
                        {
                            <option value="@participant.UserID">@participant.User.UserName</option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label for="rank" class="form-label">Rank</label>
                    <input type="number" name="rank" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="time" class="form-label">Time (hh:mm:ss)</label>
                    <input type="time" name="time" class="form-control" step="1" required />
                </div>
                <button type="submit" class="btn btn-primary">Add Entry</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            $('.edit-leaderboard-entry').click(function () {
                var entryId = $(this).data('entry-id');
                // Implement edit functionality
            });

            $('.delete-leaderboard-entry').click(function () {
                var entryId = $(this).data('entry-id');
                if (confirm('Are you sure you want to delete this leaderboard entry?')) {
                    // Implement delete functionality
                }
            });
        });
    </script>
}